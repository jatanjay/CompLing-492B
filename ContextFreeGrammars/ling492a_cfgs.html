<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<style>
body {
	font-family: Verdana, Geneva, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
	font-family: Verdana, Geneva, sans-serif;
	margin: 20px 0 10px;
  	padding: 0;
  	font-weight: bold;
  	-webkit-font-smoothing: antialiased;
  	cursor: text;
  	position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
	font-size: 28px;
    border: 3px solid #892034; 
    color: black;
	text-align:right;
}

h2 {
	font-size: 24px;
	background-color:#892034; 
    color: white; 
}

h3 {
	font-size: 18px;
    border-bottom: 1px solid #892034;
	color: black; 
}

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; 
}

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}

@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}

   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }


</style>
<title>LINGUIST492A: Working with the treebank</title>
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax:{inlineMath:[['$$$','$$$']]}});</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<h1>LINGUIST492A: Working with the treebank</h1>

<h2>Grammars in NLTK</h2>

<p>NLTK is imported like other Python libraries. To work with the grammar tools, import everything from the grammar module:</p>

<pre><code>import nltk
from nltk.grammar import *
</code></pre>

<p>There are several ways that you can create a grammar in NLTK. One way to do this is to write the grammar directly as a string. Here, we state all the rules we would like our grammar to have:</p>

<pre><code>myToyGrammar = nltk.CFG.fromstring("""
S -&gt; NP VP
NP -&gt; det N
VP -&gt; V NP
V -&gt; 'walked'
N -&gt; 'florist' | 'dog'
det -&gt; 'the' | 'my'
""")
</code></pre>

<p>What can we do with a grammar? The following are useful methods for CFG grammars in NLTK:</p>

<ul>
<li><code>.productions()</code>: Return a list of all of the productions in the grammar.</li>
<li><code>.start()</code>: Return the root node of the grammar.</li>
<li><code>.max_len()</code>: Return the length of the longest right hand side of a production (# of non-terminal nodes).</li>
<li><code>.min_len()</code>: Return the length of the smallest right hand side of a production (# of non-terminal nodes).</li>
</ul>


<p>We can also retrieve and manipulate singular <strong>productions</strong>, or grammatical rules. For example:</p>

<pre><code>s_rule = myToyGrammar.productions()[0]    ## Get first production, S -&gt; NP VP
</code></pre>

<p>We can retrieve the subparts of a production independently with the following methods:</p>

<ul>
<li><code>.lhs()</code>: Return the left hand side of the production (type: 'Nonterminal').</li>
<li><code>.rhs()</code>: Return the right hand side of the production (typed: 'Terminal', 'Nonterminal', or a tuple of 'Nonterminals').</li>
</ul>


<p>An alternative way of creating a grammar object in NLTK is to assemble one directly from a list of productions. For example:</p>

<pre><code>all_productions = myToyGrammar.productions()  ## List of all productions.
myToyGrammarCopy = nltk.CFG(nltk.grammar.Nonterminal('S'),all_productions)
</code></pre>

<p>The syntax involves providing the <code>CFG</code> method with an explicit root node (a Nonterminal object called <code>S</code>; note that this is NOT just a string!), and a list of the productions to put into the grammar. This creates an exact copy of <code>myToyGrammar</code>:</p>

<pre><code>print(myToyGrammarCopy)
Grammar with 8 productions (start state = S)
    S -&gt; NP VP
    NP -&gt; det N
    VP -&gt; V NP
    V -&gt; 'walked'
    N -&gt; 'florist'
    N -&gt; 'dog'
    det -&gt; 'the'
    det -&gt; 'my'
</code></pre>

<h2>Manipulating trees</h2>

<p>NLTK includes the Penn Treebank. Specifically, it includes a sample the Wall Street Journal section of the treebank. The Penn Treebank is a hand-annotated (parsed) version of this text. We can use these parsed trees to automatically learn about syntactic structure, as well as a way of searching for syntactic structures 'in the wild'.</p>

<p>To start, load the treebank:</p>

<pre><code>from nltk.corpus import treebank
all_trees = treebank.parsed_sents()
</code></pre>

<p><code>all_trees</code> is a list of all of the tree objects in the treebank. For now, let's retrieve one and inspect it:</p>

<pre><code>first_tree = all_trees[0]
print(first_tree)
    (S
  (NP-SBJ
    (NP (NNP Pierre) (NNP Vinken))
    (, ,)
    (ADJP (NP (CD 61) (NNS years)) (JJ old))
    (, ,))
  (VP
    (MD will)
    (VP
     (VB join)
     (NP (DT the) (NN board))
      (PP-CLR (IN as) (NP (DT a) (JJ nonexecutive) (NN director)))
      (NP-TMP (NNP Nov.) (CD 29))))
  (. .))
</code></pre>

<p><code>first_tree</code> is a <code>Tree</code> object that represents the entire tree. A tree object in NLTK is essentially a list of the subtrees that come underneath a given node. So for example, in the example above, we have a tree rooted in <code>S</code> that has three daughters: <code>NP-SBJ</code>, <code>VP</code> and <code>.</code>. The Tree object <code>first_tree</code> stores information about the node label at the top of the tree, then it gives pointers to the subtrees underneath it.</p>

<p>The subtrees are <em>also</em> trees; so for example, the <code>NP-SBJ</code> subtree is also a Tree object, with <code>NP-SBJ</code> as the label, and with four subtrees underneath it, rooted in <code>NP</code>, <code>,</code>, <code>ADJP</code>, and <code>,</code>.</p>

<p>Here are the essential method for working with trees:</p>

<ul>
<li>.label() - Return a string representation of the node label of the highest node in the tree.</li>
<li>.leaves() - Return a list of strings that give all the terminal (lexical/leaf) nodes in your tree.</li>
<li>.subtrees() - Return a generator that can interate (recursively) through all possible subtrees in your tree. <strong>This is essential if you would like to inspect every node label in your tree</strong>.</li>
<li>.production() - Return a list of productions that created this tree.</li>
<li>.draw() - Make a nice picture of the tree.</li>
<li>.height() - Return the height of the tree (length of longest path from root to terminal).</li>
</ul>


<h2>Searching in the Treebank</h2>

<p>To search within the Treebank, you should create a <strong>filter</strong>. For our purposes, a filter is a function that is applied to a Tree object and returns <code>True</code> if the tree matches your search conditions, and <code>False</code> otherwise. For example:</p>

<pre><code>def has_S_under_VP(tree):
    child_nodes = [child.label() for child in tree if isinstance(child, nltk.Tree)]
    return (tree.label() == 'VP') and ('S' in child_nodes)
</code></pre>

<p>This function has two parts. One, it retrieves the labels of all the immediate children of a given tree. This would return, for example, <code>NP-SBJ</code>, <code>VP</code> and <code>.</code> in the tree above. Then it returns a Boolean statement with evaluates to true if the current tree label is <code>VP</code>, and if the node label <code>S</code> is in the tree's daughter nodes. This filter will identify trees that have a sentence embedded under a VP.</p>

<p>To apply this filter to the Treebank, we have to iterate over trees in the treebank, and for each tree, iterate over subtrees. We want to pull out a tree if it has <em>at least one</em> subtree that matches our filter:</p>

<pre><code>my_matches = [subtree for tree in all_trees for subtree in tree.subtrees() if has_S_under_VP(subtree)]     ## pulls out every SUBTREE (i.e. VP) that matches
</code></pre>

<p>Here's another example. This one looks for existential constructions like 'there is a man in the room' in the treebank:</p>

<pre><code>def has_existential(tree):
    all_nodes = [subtree.label() for subtree in tree.subtrees()]
    return ('EX' in all_nodes)
</code></pre>

<p>This will return <code>True</code> if there is any subtree rooted in <code>EX</code>, our target existential label, and <code>False</code> otherwise. Applied to every tree in the corpus:</p>

<pre><code>my_matches = [tree for tree in all_trees if has_existential(tree)]     ## pulls out every SUBTREE (i.e. VP) that matches
</code></pre>

<h3>On your own</h3>

<p>Consult the <a href="https://www.ling.upenn.edu/courses/Fall_2003/ling001/penn_treebank_pos.html">Penn Treebank POS set</a> to learn about the labels that are used in the Penn Treebank to label different structures.
Design a filter that will find NPs that dominate a PP (e.g. "the day of the party"). Extract from the corpus all such NPs. Inspect the results; did your filter pull out only NPs that match your criteria, or did your filter unintentionally pick up some structures that weren't what was intended?</p>

<p>If you successfully retrieve a list of the NPs that dominate a PP, then a further task is to identify the prepositions that head each PP. Extract all the prepositions from the PP that modifies the NP, and tabulate the frequency of each. What's the most common preposition that modifies NPs in your sample? The second most common?</p>
</body>
</html>